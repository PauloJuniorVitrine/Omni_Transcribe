<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="2" skipped="1" tests="159" time="13.141" timestamp="2025-11-21T16:35:32.414778-03:00" hostname="DESKTOP-PBQ7OGO"><testcase classname="tests.unit.application.test_accuracy_guard_metadata" name="test_accuracy_guard_sets_metadata_and_logs" time="0.011" /><testcase classname="tests.unit.application.test_accuracy_guard_metadata" name="test_accuracy_guard_uses_reference_and_sets_requires_review" time="0.004" /><testcase classname="tests.unit.application.test_accuracy_service" name="test_accuracy_guard_updates_metadata" time="0.001" /><testcase classname="tests.unit.application.test_accuracy_service" name="test_accuracy_guard_flags_low_quality" time="0.001" /><testcase classname="tests.unit.application.test_accuracy_service" name="test_accuracy_guard_uses_reference_file_and_dispatchers" time="0.005" /><testcase classname="tests.unit.application.test_accuracy_service" name="test_accuracy_guard_dispatches_alert_when_below_threshold" time="0.001" /><testcase classname="tests.unit.application.test_accuracy_service" name="test_accuracy_guard_returns_when_job_missing" time="0.001" /><testcase classname="tests.unit.application.test_artifact_builder_and_package" name="test_filesystem_artifact_builder_generates_all_formats" time="0.902" /><testcase classname="tests.unit.application.test_artifact_builder_and_package" name="test_zip_package_service_creates_zip_and_uploads" time="0.042" /><testcase classname="tests.unit.application.test_chatgpt_service" name="test_chatgpt_service_applies_profile_rules_and_masks_pii" time="0.004" /><testcase classname="tests.unit.application.test_delivery_template_registry" name="test_registry_renders_default_and_localized" time="0.016" /><testcase classname="tests.unit.application.test_job_controller" name="test_list_jobs_returns_from_repo" time="0.001" /><testcase classname="tests.unit.application.test_job_controller" name="test_ingest_file_calls_use_case" time="0.001" /><testcase classname="tests.unit.application.test_job_controller" name="test_process_job_requires_pipeline" time="0.001" /><testcase classname="tests.unit.application.test_job_controller" name="test_requeue_job_uses_retry" time="0.001" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_json_log_formatter_outputs_structured_payload" time="0.004" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_configure_logging_is_idempotent" time="0.001" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_registry_lists_and_render" time="0.007" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_registry_localized" time="0.008" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_registry_missing_template" time="0.003" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_registry_default_fallback" time="0.008" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_registry_locale_inference_and_prefix" time="0.010" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_delivery_template_split_front_matter_without_yaml" time="0.001" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_audio_chunker_requires_pydub" time="0.001" /><testcase classname="tests.unit.application.test_logging_and_templates" name="test_audio_chunker_splits_using_stub" time="0.006" /><testcase classname="tests.unit.application.test_oauth_service" name="test_build_authorization_url_includes_params" time="0.005" /><testcase classname="tests.unit.application.test_oauth_service" name="test_exchange_code_posts_payload" time="0.006" /><testcase classname="tests.unit.application.test_package_service_zip" name="test_zip_package_writes_files_and_calls_storage" time="0.027" /><testcase classname="tests.unit.application.test_pii_masker" name="test_mask_text_replaces_email_phone_cpf" time="0.002" /><testcase classname="tests.unit.application.test_pii_masker" name="test_mask_text_idempotent_on_clean_text" time="0.001" /><testcase classname="tests.unit.application.test_rejected_logger" name="test_rejected_logger_writes_payload" time="1.104" /><testcase classname="tests.unit.application.test_retry_executor" name="test_retry_executor_retries_with_exponential_backoff" time="0.001" /><testcase classname="tests.unit.application.test_retry_executor" name="test_retry_executor_raises_last_exception" time="0.001" /><testcase classname="tests.unit.application.test_review_controller" name="test_submit_review_without_delivery" time="0.007" /><testcase classname="tests.unit.application.test_review_controller" name="test_submit_review_triggers_delivery" time="0.005" /><testcase classname="tests.unit.application.test_review_controller" name="test_submit_review_missing_job_throws" time="0.006" /><testcase classname="tests.unit.application.test_session_service" name="test_session_lifecycle_create_get_invalidate" time="0.023" /><testcase classname="tests.unit.application.test_session_service" name="test_session_expiration_removes_record" time="0.018" /><testcase classname="tests.unit.application.test_session_service" name="test_ensure_csrf_token_persists" time="0.032" /><testcase classname="tests.unit.application.test_sheet_service" name="test_csv_sheet_service_logs_and_mirrors" time="0.019" /><testcase classname="tests.unit.application.test_status_publisher" name="test_status_publisher_records_successfully" time="0.004" /><testcase classname="tests.unit.application.test_status_publisher" name="test_status_publisher_handles_failures_gracefully" time="0.004" /><testcase classname="tests.unit.application.test_subtitle_and_validator" name="test_subtitle_formatter_wraps_text_into_allowed_lines" time="0.001" /><testcase classname="tests.unit.application.test_subtitle_and_validator" name="test_transcript_validator_flags_long_lines_and_speed" time="0.001" /><testcase classname="tests.unit.application.test_webhook_service" name="test_webhook_service_accepts_valid_signature" time="0.007" /><testcase classname="tests.unit.application.test_webhook_service" name="test_webhook_service_rejects_missing_signature" time="1.173" /><testcase classname="tests.unit.application.test_webhook_service" name="test_webhook_service_rejects_stale_timestamp" time="0.005" /><testcase classname="tests.unit.application.test_webhook_service" name="test_webhook_service_requires_secret" time="0.006" /><testcase classname="tests.unit.application.test_whisper_service" name="test_whisper_service_calls_engine_and_maps_segments" time="0.004" /><testcase classname="tests.unit.application.test_whisper_service" name="test_whisper_service_errors_without_client" time="0.003" /><testcase classname="tests.unit.application.test_whisper_service" name="test_whisper_service_chunks_large_file" time="0.008" /><testcase classname="tests.unit.application.test_whisper_service_chunking" name="test_whisper_service_chunking_adjusts_segments_and_cleans_chunks" time="0.009" /><testcase classname="tests.unit.config.test_runtime_credentials" name="test_store_encrypts_payload_and_logs_audit" time="0.153" /><testcase classname="tests.unit.config.test_runtime_credentials" name="test_encrypted_payload_requires_secret" time="0.004"><skipped type="pytest.skip" message="Skip when running under global TEST_MODE=1">C:\Users\User\Desktop\Nova pasta\PROJETOS\Omni Transcribe\tests\unit\config\test_runtime_credentials.py:38: Skip when running under global TEST_MODE=1</skipped></testcase><testcase classname="tests.unit.domain.test_create_job" name="test_create_job_uses_profile_and_logs_creation" time="0.007" /><testcase classname="tests.unit.domain.test_create_job" name="test_create_job_notifies_status_publisher" time="0.005" /><testcase classname="tests.unit.domain.test_create_job_metadata" name="test_create_job_sets_template_and_locale_metadata" time="0.008"><failure message="AssertionError: assert 'delivery_locale_updated_at' in {'delivery_locale': 'en_us', 'delivery_template': 'custom', 'delivery_template_updated_at': '2025-11-21T19:35:37.295461+00:00', 'source_folder': 'geral'}&#10; +  where {'delivery_locale': 'en_us', 'delivery_template': 'custom', 'delivery_template_updated_at': '2025-11-21T19:35:37.295461+00:00', 'source_folder': 'geral'} = Job(id='38c453ce10d24a77b6973eda62f2d05a', source_path=WindowsPath('C:/Users/User/AppData/Local/Temp/pytest-of-User/py...o=datetime.timezone.utc), updated_at=datetime.datetime(2025, 11, 21, 19, 35, 37, 295492, tzinfo=datetime.timezone.utc)).metadata">tmp_path = WindowsPath('C:/Users/User/AppData/Local/Temp/pytest-of-User/pytest-350/test_create_job_sets_template_0')

    def test_create_job_sets_template_and_locale_metadata(tmp_path):
        profile = Profile(
            id="geral",
            meta={"delivery_template": "custom", "default_locale": "pt-BR"},
            prompt_body="prompt",
        )
        repo = _Repo()
        logs = LogRepositorySpy()
        use_case = CreateJobFromInbox(
            job_repository=repo,
            profile_provider=_StubProvider(profile),
            log_repository=logs,
            default_profile="geral",
        )
    
        audio = tmp_path / "inbox" / "geral" / "audio.wav"
        audio.parent.mkdir(parents=True, exist_ok=True)
        audio.write_text("a", encoding="utf-8")
        job = use_case.execute(
            CreateJobInput(
                source_path=audio,
                profile_id=None,
                engine=EngineType.OPENAI,
                metadata={"delivery_locale": "en_us"},
            )
        )
    
        assert job.metadata["delivery_template"] == "custom"
        assert job.metadata["delivery_locale"] in {"en-us", "en_us"}
        assert "delivery_template_updated_at" in job.metadata
&gt;       assert "delivery_locale_updated_at" in job.metadata
E       AssertionError: assert 'delivery_locale_updated_at' in {'delivery_locale': 'en_us', 'delivery_template': 'custom', 'delivery_template_updated_at': '2025-11-21T19:35:37.295461+00:00', 'source_folder': 'geral'}
E        +  where {'delivery_locale': 'en_us', 'delivery_template': 'custom', 'delivery_template_updated_at': '2025-11-21T19:35:37.295461+00:00', 'source_folder': 'geral'} = Job(id='38c453ce10d24a77b6973eda62f2d05a', source_path=WindowsPath('C:/Users/User/AppData/Local/Temp/pytest-of-User/py...o=datetime.timezone.utc), updated_at=datetime.datetime(2025, 11, 21, 19, 35, 37, 295492, tzinfo=datetime.timezone.utc)).metadata

tests\unit\domain\test_create_job_metadata.py:62: AssertionError</failure></testcase><testcase classname="tests.unit.domain.test_create_job_metadata" name="test_create_job_respects_profile_inferred_from_folder" time="0.018" /><testcase classname="tests.unit.domain.test_post_edit_usecase" name="test_post_edit_transcript_updates_status_and_logs" time="0.004" /><testcase classname="tests.unit.domain.test_post_edit_usecase" name="test_post_edit_transcript_handles_failure" time="0.003" /><testcase classname="tests.unit.domain.test_process_job_pipeline_retry" name="test_pipeline_success_invokes_guard_and_returns_artifacts" time="0.005" /><testcase classname="tests.unit.domain.test_process_job_pipeline_retry" name="test_pipeline_error_triggers_retry_with_stage" time="0.001" /><testcase classname="tests.unit.domain.test_process_job_pipeline_retry" name="test_pipeline_error_marks_non_retryable_when_disabled" time="0.001" /><testcase classname="tests.unit.domain.test_register_delivery" name="test_register_delivery_submits_external_and_logs" time="0.004" /><testcase classname="tests.unit.domain.test_register_delivery" name="test_register_delivery_requires_approved_job" time="0.003" /><testcase classname="tests.unit.domain.test_register_delivery" name="test_register_delivery_requires_artifacts" time="0.003" /><testcase classname="tests.unit.domain.test_register_delivery" name="test_register_delivery_enforces_existing_job" time="0.003" /><testcase classname="tests.unit.domain.test_retry_or_reject" name="test_retry_or_reject_writes_failure_file" time="0.017" /><testcase classname="tests.unit.domain.test_retry_or_reject" name="test_retry_or_reject_requeues_and_notifies" time="0.004" /><testcase classname="tests.unit.domain.test_run_asr_pipeline" name="test_run_asr_pipeline_updates_status_and_language" time="0.002" /><testcase classname="tests.unit.domain.test_run_asr_pipeline" name="test_run_asr_pipeline_marks_failure_on_exception" time="0.001" /><testcase classname="tests.unit.infrastructure.test_api_clients" name="test_gotranscript_client_submit_package_sends_payload" time="0.006" /><testcase classname="tests.unit.infrastructure.test_api_clients" name="test_local_storage_client_uploads_file" time="0.007" /><testcase classname="tests.unit.infrastructure.test_api_clients" name="test_s3_storage_client_uploads_with_prefix" time="0.005" /><testcase classname="tests.unit.infrastructure.test_components_asr" name="test_build_core_usecases_raises_without_api_key" time="0.001" /><testcase classname="tests.unit.infrastructure.test_components_asr" name="test_build_asr_clients_supports_local_engine" time="0.001" /><testcase classname="tests.unit.infrastructure.test_components_asr" name="test_build_core_usecases_wire_services" time="0.001" /><testcase classname="tests.unit.infrastructure.test_components_delivery_and_repos" name="test_build_logging_and_sheet_returns_services" time="0.008" /><testcase classname="tests.unit.infrastructure.test_components_delivery_and_repos" name="test_sheet_gateway_validation" time="0.001" /><testcase classname="tests.unit.infrastructure.test_components_delivery_and_repos" name="test_build_delivery_services_handles_clients" time="0.009" /><testcase classname="tests.unit.infrastructure.test_components_delivery_and_repos" name="test_file_log_repository_append_and_list" time="0.082" /><testcase classname="tests.unit.infrastructure.test_components_delivery_and_repos" name="test_file_review_repository_save_and_find" time="0.032" /><testcase classname="tests.unit.infrastructure.test_file_job_repository" name="test_file_job_repository_store_and_update" time="0.032" /><testcase classname="tests.unit.infrastructure.test_file_job_repository" name="test_file_job_repository_list_recent_order" time="0.020" /><testcase classname="tests.unit.infrastructure.test_file_repositories" name="test_file_artifact_repository_save_and_list" time="0.020" /><testcase classname="tests.unit.infrastructure.test_file_repositories" name="test_file_log_repository_appends_and_orders" time="0.032" /><testcase classname="tests.unit.infrastructure.test_file_repositories" name="test_file_review_repository_latest" time="0.029" /><testcase classname="tests.unit.infrastructure.test_gotranscript_client" name="test_submit_package_success" time="0.004" /><testcase classname="tests.unit.infrastructure.test_gotranscript_client" name="test_submit_package_error_raises" time="0.005" /><testcase classname="tests.unit.infrastructure.test_metrics_logger" name="test_record_metric_writes_entry" time="0.016" /><testcase classname="tests.unit.infrastructure.test_metrics_logger" name="test_notify_alert_appends_and_falls_back" time="0.037" /><testcase classname="tests.unit.infrastructure.test_metrics_logger" name="test_post_webhooks_handles_success_and_errors" time="0.006" /><testcase classname="tests.unit.infrastructure.test_metrics_logger" name="test_load_entries_limits_and_skips_invalid" time="0.005" /><testcase classname="tests.unit.infrastructure.test_metrics_logger" name="test_report_accuracy_metrics_stream" time="0.044" /><testcase classname="tests.unit.infrastructure.test_service_container" name="test_load_reference_prefers_inline_metadata" time="0.026" /><testcase classname="tests.unit.infrastructure.test_service_container" name="test_load_reference_from_file_and_cache" time="0.009" /><testcase classname="tests.unit.infrastructure.test_service_container" name="test_load_reference_falls_back_to_profile_cache" time="0.027" /><testcase classname="tests.unit.infrastructure.test_sheets_gateway" name="test_google_sheets_gateway_appends_row" time="0.007" /><testcase classname="tests.unit.infrastructure.test_storage_clients" name="test_local_storage_upload_copies_file" time="0.014" /><testcase classname="tests.unit.infrastructure.test_storage_clients" name="test_s3_storage_client_uses_boto3_stub" time="0.005" /><testcase classname="tests.unit.interfaces.cli.test_run_job_cli" name="test_run_job_requires_job_id_or_file" time="0.009" /><testcase classname="tests.unit.interfaces.cli.test_run_job_cli" name="test_run_job_process_existing" time="0.006" /><testcase classname="tests.unit.interfaces.cli.test_run_job_cli" name="test_run_job_ingest_file" time="0.005" /><testcase classname="tests.unit.interfaces.cli.test_run_job_cli" name="test_run_job_raises_when_file_missing" time="0.003" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_handle_audio_skips_large_file" time="0.006" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_handle_audio_creates_job_and_runs_pipeline" time="0.005" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_run_pipeline_logs_error" time="0.004" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_on_created_ignores_directories" time="1.211" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_on_created_ignores_unsupported_extension" time="0.013" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_handle_audio_defaults_profile_when_outside_input" time="0.009" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_on_created_triggers_handle_audio" time="0.006" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_main_handles_keyboard_interrupt" time="0.007" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox" name="test_handle_audio_logs_when_pipeline_missing" time="0.008" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox_chunking" name="test_watcher_uses_chunking_threshold" time="0.011" /><testcase classname="tests.unit.interfaces.cli.test_watch_inbox_end_to_end" name="test_watcher_skips_large_and_processes_small" time="0.011" /><testcase classname="tests.unit.interfaces.http.test_app_helpers" name="test_compute_accuracy_summary_counts_and_average" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers" name="test_compose_accuracy_snapshot_returns_badge" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers" name="test_enforce_download_rate" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_enforce_download_rate_limits_requests" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_enforce_download_rate_discards_old_entries" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_validate_download_token_accepts_and_rejects" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_flash_message_and_safe_int" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_apply_filters_and_summary_helpers" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_compute_accuracy_summary_handles_invalid_values" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_compose_accuracy_snapshot_and_format_label" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_compose_accuracy_snapshot_handles_custom_status" time="0.002" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_load_template_audit_and_incidents" time="0.010" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_recent_incidents_handles_missing_repo" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_recent_incidents_handles_repo_error" time="0.002" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_summarize_session_handles_metadata" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_job_logs_handles_missing_repo" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_job_logs_handles_container_error" time="0.002" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_get_job_logs_returns_sorted_entries" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_normalize_template_id_and_locale" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_compose_template_file_and_render" time="0.021" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_available_template_locales_and_guess" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_helpers_extra" name="test_serialize_artifacts_handles_enum_and_str" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_wiring" name="test_get_job_controller_dep_uses_container" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_wiring" name="test_get_review_controller_dep_injects_dependencies" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_app_wiring" name="test_get_job_log_service_returns_service" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_auth_routes" name="test_login_and_callback_sets_session_cookie" time="0.047" /><testcase classname="tests.unit.interfaces.http.test_csrf_and_session" name="test_protected_post_requires_csrf_token" time="0.241" /><testcase classname="tests.unit.interfaces.http.test_csrf_and_session" name="test_session_expired_denied" time="0.017" /><testcase classname="tests.unit.interfaces.http.test_dependencies" name="test_get_webhook_service_caches_instances" time="0.006" /><testcase classname="tests.unit.interfaces.http.test_dependencies" name="test_require_active_session_rejects_missing_session" time="0.004" /><testcase classname="tests.unit.interfaces.http.test_dependencies" name="test_require_active_session_enforces_csrf_header" time="0.003" /><testcase classname="tests.unit.interfaces.http.test_dependencies" name="test_require_active_session_accepts_form_token" time="0.003" /><testcase classname="tests.unit.interfaces.http.test_download_rate_limit" name="test_enforce_download_rate_allows_within_limit" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_download_rate_limit" name="test_enforce_download_rate_blocks_after_limit" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_download_token" name="test_validate_download_token_accepts_valid_signature" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_download_token" name="test_validate_download_token_rejects_missing[None-None-missing token]" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_download_token" name="test_validate_download_token_rejects_missing[bad-None-missing expires]" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_download_token" name="test_validate_download_token_rejects_expired_or_invalid" time="0.001" /><testcase classname="tests.unit.interfaces.http.test_oauth_end_to_end" name="test_oauth_browser_flow_sets_cookie_and_redirect" time="0.019" /><testcase classname="tests.unit.interfaces.http.test_template_locale_csrf" name="test_template_and_locale_updates_require_csrf" time="1.529" /><testcase classname="tests.unit.interfaces.http.test_upload_and_download_flow" name="test_upload_creates_job_and_download_requires_token" time="0.045"><failure message="assert 401 in (303, 307)&#10; +  where 401 = &lt;Response [401 Unauthorized]&gt;.status_code">tmp_path = WindowsPath('C:/Users/User/AppData/Local/Temp/pytest-of-User/pytest-350/test_upload_creates_job_and_do0')
monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x000002C0812E82F0&gt;

    def test_upload_creates_job_and_download_requires_token(tmp_path, monkeypatch):
        settings = get_settings()
        settings.openai_api_key = "test-key"
        settings.base_input_dir = tmp_path / "inbox"
        settings.base_output_dir = tmp_path / "output"
        settings.base_processing_dir = tmp_path / "processing"
        settings.base_backup_dir = tmp_path / "backup"
        settings.base_rejected_dir = tmp_path / "rejected"
        settings.csv_log_path = tmp_path / "output" / "log.csv"
        settings.ensure_runtime_directories()
    
        # fresh container for isolated dirs
        from infrastructure.container.service_container import ServiceContainer
    
        get_container._instance = ServiceContainer(settings=settings)  # type: ignore[attr-defined]
    
        client = TestClient(app)
    
        audio_path = tmp_path / "sample.wav"
        audio_path.write_bytes(b"RIFF0000")  # dummy
        files = {"file": ("sample.wav", audio_path.read_bytes(), "audio/wav")}
        data = {"profile": "geral", "engine": EngineType.OPENAI.value, "auto_process": "false"}
        resp = client.post("/jobs/upload", files=files, data=data)
&gt;       assert resp.status_code in (303, 307)
E       assert 401 in (303, 307)
E        +  where 401 = &lt;Response [401 Unauthorized]&gt;.status_code

tests\unit\interfaces\http\test_upload_and_download_flow.py:45: AssertionError</failure></testcase><testcase classname="tests.unit.interfaces.http.test_upload_auto_process_pipeline" name="test_upload_auto_process_sets_accuracy_metadata" time="0.169" /><testcase classname="tests.unit.scripts.test_generate_runtime_credentials" name="test_generator_creates_encrypted_file" time="0.719" /><testcase classname="tests.unit.scripts.test_generate_runtime_credentials" name="test_generator_requires_secret" time="0.685" /></testsuite></testsuites>