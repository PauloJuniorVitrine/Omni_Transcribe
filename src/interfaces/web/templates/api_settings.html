{% extends "base.html" %}

{% block content %}
<section class="api-settings" data-surface="api-settings">
  <header class="section-header">
    <div>
      <h2>APIs & Modelos</h2>
      <p>Gerencie as credenciais usadas pelo Whisper (ASR) e ChatGPT (pos-edicao).</p>
    </div>
    {% if flash_message %}
    <div
      class="flash flash-{{ flash_message.variant }}"
      data-toast="true"
      data-toast-variant="{{ flash_message.variant }}"
    >
      {{ flash_message.text }}
    </div>
    {% endif %}
  </header>

  <div class="settings-skeleton" data-skeleton="api-settings" hidden aria-hidden="true">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>

  <div class="settings-grid">
    <form
      method="post"
      class="card settings-card"
      data-loading-surface="api-settings"
      data-ajax="true"
      data-success-message="Credenciais Whisper atualizadas."
    data-error-message="Nao foi possivel salvar Whisper."
    data-updated-target="whisper"
  >
      <input type="hidden" name="csrf_token" value="{{ csrf_token | default('', true) }}" />
      <input type="hidden" name="target" value="whisper" />
      <h3>Whisper / ASR</h3>
      <p>Utilizado no pipeline de transcricao.</p>
      <label>
        Chave API
        <input
          type="password"
          name="whisper_api_key"
          value="{{ whisper.api_key }}"
          placeholder="sk-live..."
          autocomplete="off"
        />
      </label>
      <label>
        Modelo
        <select name="whisper_model">
          {% for model in whisper_models %}
          <option value="{{ model }}" {% if model == whisper.model %}selected{% endif %}>{{ model }}</option>
          {% endfor %}
        </select>
      </label>
      <small class="settings-meta" data-updated-label="whisper"></small>
      <button type="submit" class="btn btn-primary" data-loading="Salvando...">Salvar Whisper</button>
    </form>

    <form
      method="post"
      class="card settings-card"
      data-loading-surface="api-settings"
      data-ajax="true"
      data-success-message="Credenciais ChatGPT atualizadas."
      data-error-message="Nao foi possivel salvar ChatGPT."
      data-updated-target="chatgpt"
  >
      <input type="hidden" name="csrf_token" value="{{ csrf_token | default('', true) }}" />
      <input type="hidden" name="target" value="chatgpt" />
      <h3>ChatGPT / Pos-edicao</h3>
      <p>Responsavel por ajustes e formatacao da transcricao.</p>
      <label>
        Chave API
        <input
          type="password"
          name="chatgpt_api_key"
          value="{{ chatgpt.api_key }}"
          placeholder="sk-live..."
          autocomplete="off"
        />
      </label>
      <label>
        Modelo
        <select name="chatgpt_model">
          {% for model in chatgpt_models %}
          <option value="{{ model }}" {% if model == chatgpt.model %}selected{% endif %}>{{ model }}</option>
          {% endfor %}
        </select>
      </label>
      <small class="settings-meta" data-updated-label="chatgpt"></small>
      <button type="submit" class="btn btn-primary" data-loading="Salvando...">Salvar ChatGPT</button>
    </form>
  </div>
</section>

<section class="card branding-card">
  <div class="section-header">
    <div>
      <h2>Logomarca do workspace</h2>
      <p>Imagem exibida no hero e cabecalho. Formatos: PNG, JPG, WEBP ou SVG.</p>
    </div>
  </div>
  <form
    action="/settings/branding/logo"
    method="post"
    enctype="multipart/form-data"
    data-updated-label="branding"
    class="upload-form"
  >
    <input type="hidden" name="csrf_token" value="{{ csrf_token | default('', true) }}" />
    <div class="branding-grid">
      <label class="field">
        <span class="field-label">Arquivo de logo</span>
        <div class="file-field" data-file-input>
          <input type="file" name="logo" accept=".png,.jpg,.jpeg,.webp,.svg" required />
          <span class="file-button">Escolher arquivo</span>
          <span class="file-name" data-file-name>Nenhum arquivo selecionado</span>
        </div>
        <span class="field-help">Resolucao sugerida: 256x256. Transparencia suportada.</span>
      </label>
      <div class="logo-preview">
        {% if branding_logo_url %}
        <div class="logo-image brand-avatar">
          <img src="{{ branding_logo_url }}" alt="Logomarca atual" />
        </div>
        {% else %}
        <div class="logo-mark brand-avatar">OT</div>
        {% endif %}
        <small>Preview da logo que aparece no dashboard.</small>
      </div>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Atualizar logo</button>
    </div>
  </form>
</section>
{% endblock %}
